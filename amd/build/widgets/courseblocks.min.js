/**
 * Cohorts Info widgets.
 *
 * @module     report_lmsace_reports/courseblocks
 * @copyright  2023 LMSACE <https://lmsace.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("report_lmsace_reports/widgets/courseblocks",["report_lmsace_reports/widgets/enroll_completion","report_lmsace_reports/widgets/enroll_completion_month","report_lmsace_reports/widgets/coursestatus","core/chartjs"],(function(enrollCompletion,enrollCompletionMonth,courseStatus){var courseBlocks={enrollCompletion:{func:enrollCompletion},enrollCompletionMonth:{func:enrollCompletionMonth},courseStatus:{func:courseStatus}},loadCharts=function(main){showActiveInactiveUsersChart(main),showHighScoreCourse(main);for(var key in courseBlocks)courseBlocks[key].func.init(main)},showHighScoreCourse=function(main){let ctx=document.getElementById("high-score-course-chart");if(ctx){let type="bar";var bgColor=main.getRandomColors(["c2"]),customConfig={data:{datasets:[{label:coursehighscore.strscore}]},options:{plugins:{datalabels:{backgroundColor:!1,borderWidth:2,borderColor:function(context){return context.dataset.backgroundColor},color:function(context){return context.dataset.backgroundColor}}}}};main.buildChart(ctx,type,coursehighscore.label,coursehighscore.score,bgColor,customConfig,null)}},showActiveInactiveUsersChart=function(main){let ctx=document.getElementById("active-inactive-users-chart");if(ctx){let type="line";var bgColor=main.getRandomColors(["c7"],".5",!0),borderColor=main.getRandomColors(["c7"]),bgColor2=main.getRandomColors(["c4"],".5",!0),borderColor2=main.getRandomColors(["c4"]),options=main.getMultiDatasetOptions();options.maintainAspectRatio=!1;var customConfig={options:options,data:{datasets:[{label:courseactiveinactiveusers.activeusers,data:courseactiveinactiveusers.activeusers_data,backgroundColor:bgColor,borderColor:borderColor,datalabels:{align:240}},{label:courseactiveinactiveusers.inactiveusers,data:courseactiveinactiveusers.inactiveusers_data,backgroundColor:bgColor2,borderColor:borderColor2,fill:!0,datalabels:{align:-45}}]}};main.buildChart(ctx,type,courseactiveinactiveusers.label,null,null,customConfig)}},initCategoryFilter=function(){var applyBtn=document.getElementById("course-category-apply"),clearBtn=document.getElementById("course-category-clear"),select=document.getElementById("course-category-filter");applyBtn&&select&&applyBtn.addEventListener("click",(function(){var url=new URL(window.location.href);url.searchParams.set("report","coursereport");var val=select.value;val&&"0"!==val?url.searchParams.set("coursecategory",val):url.searchParams.delete("coursecategory"),window.location.href=url.toString()})),clearBtn&&select&&clearBtn.addEventListener("click",(function(){var url=new URL(window.location.href);url.searchParams.set("report","coursereport"),url.searchParams.delete("coursecategory"),window.location.href=url.toString()}))};return{init:function(main){initCategoryFilter(),loadCharts(main)}}}));
